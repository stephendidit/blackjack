<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Blackjack Attempt</title>
<!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" /> -->
<!-- <link rel="stylesheet" type="text/css" href="css/main.css" /> -->
</head>
<body>

* 1. Build Deck // built as buildDeck()
* Create Dealer
* Create Player
* 2. Shuffle Deck // built as shuffle()
* 3. player Places Wager
  * wager = wager1
* 4. Deal one card to player (face up)
* 5. Deal one card to dealer (face down)
* 6. Deal one card to player (face up)
* 7. Deal one card to dealer (face up)

8. Dealer Hits Until Score of >= 17

Resolve Wagers
def resolve
  hands.each
    if hand == dealer
      push (player keeps original wager)
    else
      if hand <= 21
        if dealer > 21
          hand wins
        elsif hand > dealer
          hand wins
        elsif hand > player
          house wins
      elsif hand > 21
        house wins
      end
    end
  end
end

Discard Used Cards
Shuffle Remaining Cards and begin again

<div>
  <button id="Hit">Hit</button>
  <button id="Stay">Stay</button>
  <button id="Double">Double</button>
  <button id="Split">Split</button>
  <button id="Draw/Push">Draw/Push</button>
</div>


    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <!-- <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script> -->
    <!-- <script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js" crossorigin="anonymous"></script> -->
    <!-- <script src="https://use.fontawesoplayer.com/343cc4bbfb.js"></script> -->
    <script>




    // GLOBAL //
    var suitsArray = ['h','s','c','d'];
    var valuesArray = [['a',1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9],[10,10],['j',10],['q',10],['k',10]];
    function totalHand(hand){ // total up a player's hand? or just the dealer's?
              // console.info(handCurrentlyBeingPlayed.hand)

      var totalValueOfHand = 0; // zero out the total
      var numberOfAcesInHand = 0; // zero out the number of aces...i think this is dealer's totaling, then.
      var CARD_VALUE_OFFSET = 1;
      hand.forEach(function(card){ // for each element in the dealer's hand
        // console.info(c)
        if (card[CARD_VALUE_OFFSET] == 1) {
          numberOfAcesInHand += 1; // add 1 to the number of aces we're counting
        } else { // but if it's not an ace...
          totalValueOfHand += card[CARD_VALUE_OFFSET]; // then add the card to the total
        }
      });

      while (numberOfAcesInHand > 0){ // while there's more than 0 aces
        if ((totalValueOfHand + 11) > 21){ // if the total + 11 goes over 21
          totalValueOfHand +=1; // then the ace needs to be treated as a 1
        } else { // otherwise
          totalValueOfHand += 11; // treat it as an 11
        }
        numberOfAcesInHand--; // remove one ace from the count
      }

      return totalValueOfHand;

    }


    // DECK //
    
    function Deck(){
      console.log("New deck.");
      this.cards = [];

      this.build = function(requestedNumberOfDecks){
        var ValuesArrayFaceOffset = 0;
        var ValuesArrayFaceValueOffset = 1;
        var numberOfDecksBuilt = 0;
        var cardsArrayOffset = 0;

        while (numberOfDecksBuilt < requestedNumberOfDecks){          
          suitsArray.forEach(function (suit){ // for each symbol
            valuesArray.forEach(function(value){ // for each value
              
              // I'D RATHER THE NEXT LINES BEGIN W/ this.cards, BUT THAT PRODUCES AN ERROR THAT DECK.CARDS IS UNDEFINED. WHY?
              deck.cards[cardsArrayOffset] = []; // make an element that's also an array for the new card, in the position of the current index
              deck.cards[cardsArrayOffset][0] = suit + value[ValuesArrayFaceOffset]; // the the new element/array's first element = symbol + value[0]
              deck.cards[cardsArrayOffset][1] = value[ValuesArrayFaceValueOffset]; // the new element/array's second element = value[1]
              cardsArrayOffset++; // increase the index
            });
          });
          numberOfDecksBuilt++;
        }
        console.log("Deck built.");
      }; // end build

      this.shuffle = function(){ // https://github.com/coolaj86/knuth-shuffle , http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
      
        var currentIndex = this.cards.length, temporaryValue, randomIndex;
        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;

          // And swap it with the current element.
          temporaryValue = this.cards[currentIndex];
          this.cards[currentIndex] = this.cards[randomIndex];
          this.cards[randomIndex] = temporaryValue;
        } // end while
        console.log("Shuffled deck.");
      }; // end shuffle

      this.hit = function(){
        this.shuffle();
        return this.cards.pop();
      };

    } // end Deck

    // DEALER //

    function Dealer(){
      this.hand = [];

      this.draw = function(){
        this.hand.push( deck.hit() );
      };

      this.play = function(){
        
        this.totalValueOfDealerHand = totalHand(this.hand); // who knows what this var is?
        console.info(this.totalValueOfDealerHand); // should begin as 0, i guess....
        while (this.totalValueOfDealerHand <= 17) { // if sometotal is less than 17...sometotal should be the more like dealer.total
          dealer.draw(); // draw again
          this.totalValueOfDealerHand = totalHand(this.hand); // and re-total the hand
        }
      };
    }

    function Player(){
      // this.hand = [];
      this.purse = 100;
      this.wager = 25;

      this.draw = function(whichHandNumber){
        this.hands[whichHandNumber]['hand'].push( deck.hit() );
        console.log("just drew");
      };

      this.hands = {
          1: {
            hand: [],
            played: false
          }
        };
      this.play = function(){ // this is for the user to play his hand
        for (var oneOfPlayersHands in this.hands){ 
          var handCurrentlyBeingPlayed = this.hands[oneOfPlayersHands];
          handCurrentlyBeingPlayed.totalValue = totalHand(handCurrentlyBeingPlayed.hand);
          console.log("pre-while Hand value: " + handCurrentlyBeingPlayed.totalValue);
          var firstRoundOfDecisionMakingForPlayer = true;

          
          if ( (Object.keys(handCurrentlyBeingPlayed.hand).length == 2) && handCurrentlyBeingPlayed.totalValue == 21) { 
            alert("BLACKJACK YOU FOOL!");
            this.purse += (this.wager * 1.5);
            handCurrentlyBeingPlayed['played'] = true;
            alert("$" + this.purse);
          }


          while (!handCurrentlyBeingPlayed['played']){ // 
            
            var options = [];
        //     if ("2 identical cards"){
        //       options << "split";
        //     }  
            if (firstRoundOfDecisionMakingForPlayer === true){
              options.push("double","stay","hit");
              firstRoundOfDecisionMakingForPlayer = false;
            } else {
              options.push("stay","hit");
            }
            var move = window.prompt("for hand " + oneOfPlayersHands + " " + options);
            $('button').click(function(){
              move = this.text;
            });
            switch(move){
              case "stay":
                handCurrentlyBeingPlayed.played = true;
                break;
              case "hit":
                player.draw(oneOfPlayersHands);
                handCurrentlyBeingPlayed.totalValue = totalHand(handCurrentlyBeingPlayed.hand);
                if (handCurrentlyBeingPlayed.totalValue > 21){
                  handCurrentlyBeingPlayed.played = true;
                  console.log("BUST!");
                }
                break;
              case "split":
                var totalNumberOfPlayerHands = (Object.keys(this.hands).length); // gets "object of objects" length
                this.hands[totalNumberOfPlayerHands + 1] = {hand:[], played: false}; // new object assigned to next integer
                player.draw(totalNumberOfPlayerHands + 1);
                player.draw(totalNumberOfPlayerHands + 1);
                console.log(player.hands);
                console.log("begin play again...");
                player.play(); // begin playing from the top to refresh the counts on all the things....
                break;
              case "double":
                handCurrentlyBeingPlayed.wager *= 2;
                player.draw();
//                handCurrentlyBeingPlayed.totalValue = totalHand(hand);
                break;
              // default:
                // console.log("QUIT");
                // handCurrentlyBeingPlayed.played = true;
                // break;
            } // switch
            handCurrentlyBeingPlayed.totalValue = totalHand(handCurrentlyBeingPlayed.hand);
            console.log("post-move/inside while Hand value: " + handCurrentlyBeingPlayed.totalValue);

            // alert(hand.totalValue);
          }  // while hand unplayed
          console.log("out of the while loop now");
        } // hands each
      }; // def play
    }

    // GET USER PREFS //

    var howManyDecks = 1;


    // TESTS

    var deck = new Deck();
    deck.build(howManyDecks);

    // card = deck.hit(deck.cards);
    // console.log(card);

    var dealer = new Dealer();

    var player = new Player();

    dealer.draw(); 
    player.draw(1);
    dealer.draw(); // this one would be face down 
    player.draw(1);

    player.play(); 
    dealer.play(); 

    // dealer.draw();

    // console.log("Dealer hand:");
    // console.log(dealer.hand);

    // console.log("My hand:");
    // console.log(player.hands[0]);
    
    </script>




</body>
</html>